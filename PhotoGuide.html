<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Callirhoe - Photo Guide</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Callirhoe</h1>
        <h2>Photo Guide</h2>
        <a href="https://github.com/geotz/callirhoe" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">


<p>For this tutorial we'll be using 3 flickr photos by <a href="https://www.flickr.com/photos/dexxus">dexxus</a>. Let us first thank dexxus for these amazing photos (btw, some of his photos are used in Linux Mint backgrounds).</p>
<p>Here's how the original photos look like:
<table><tr>
<td><img src="images/calmagick/orig/gunn.jpg" alt="images/calmagick/orig/gunn.jpg" /></td>
<td><img src="images/calmagick/orig/nostalgia.jpg" alt="images/calmagick/orig/nostalgia.jpg" /></td>
<td><img src="images/calmagick/orig/verdon.jpg" alt="images/calmagick/orig/verdon.jpg" /></td>
</tr>
<table>
</p>
<h2 id="basic-usage">Basic usage</h2>
<p>Let's see what happens when one simply runs CalMagick:</p>
<p><pre><code>$ calmagick image.jpg</code></pre></p>
<p>Here's what we obtain (<code>image_calmagick.jpg</code>):
<table><tr>
<td><img src="images/calmagick/year1/gunn.jpg" alt="images/calmagick/year1/gunn.jpg" /></td>
<td><img src="images/calmagick/year1/nostalgia.jpg" alt="images/calmagick/year1/nostalgia.jpg" /></td>
<td><img src="images/calmagick/year1/verdon.jpg" alt="images/calmagick/year1/verdon.jpg" /></td>
</tr></table>
</p>
<p>Whoops! Not quite what we had in mind! That's because CalMagick invokes callirhoe with the default options, thus a yearly calendar is created. At the same time, minimal-entropy placement is chosen, starting at about 1/3 of image size (<code>--min-size</code> default argument). We may choose center placement (<code>--placement</code>), which by default centers at 80% (<code>--max-size</code>):</p>
<p><pre><code>$ calmagick image.jpg --placement=center</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/year2/gunn.jpg" alt="images/calmagick/year2/gunn.jpg" /></td>
<td><img src="images/calmagick/year2/nostalgia.jpg" alt="images/calmagick/year2/nostalgia.jpg" /></td>
<td><img src="images/calmagick/year2/verdon.jpg" alt="images/calmagick/year2/verdon.jpg" /></td>
</tr></table>
</p>
<p>However, CalMagick was designed with monthly calendars in mind. Usually, you want to have each month on a different photo. Just provide the additional <code>callirhoe</code> arguments (2 positional parameters), i.e., month and year (or use 0 for current month/year).</p>
<p><pre><code>$ calmagick image.jpg 0 0</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/m1/gunn.jpg" alt="images/calmagick/m1/gunn.jpg" /></td>
<td><img src="images/calmagick/m1/nostalgia.jpg" alt="images/calmagick/m1/nostalgia.jpg" /></td>
<td><img src="images/calmagick/m1/verdon.jpg" alt="images/calmagick/m1/verdon.jpg" /></td>
</tr></table>
</p>
<h3 id="placement-algorithm">Placement algorithm</h3>
<p>The default placement algorithm is <em>minimal-entropy overlap</em>.
Roughly, the algorithm works as follows:
<ol><small><li> Find the smallest size minimum-entropy rectangle (<code>--min-size</code>), by sliding through the image.
Let <em>S</em> be that entropy.</i>
<li>Relax the value of <em>S</em>, 20% by default (<code>--relax</code>).</li>
<li>Starting from the biggest size rectangles (<code>--max-size</code>), scan through the image until the
relaxed value <em>S</em> is attained. Try smaller rectangles if previous pass fails, until size limit is reached.
</li></small></ol></p>
<p>Let's see what happens if we relax by a bigger factor, say 50% instead of 20%.</p>
<p><pre><code>$ calmagick image.jpg 0 0 --relax=0.5</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/m2/gunn.jpg" alt="images/calmagick/m2/gunn.jpg" /></td>
<td><img src="images/calmagick/m2/nostalgia.jpg" alt="images/calmagick/m2/nostalgia.jpg" /></td>
<td><img src="images/calmagick/m2/verdon.jpg" alt="images/calmagick/m2/verdon.jpg" /></td>
</tr></table>
</p>
<p>Or we may choose not to relax at all:</p>
<p><pre><code>$ calmagick image.jpg 0 0 --relax=0</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/m3/gunn.jpg" alt="images/calmagick/m3/gunn.jpg" /></td>
<td><img src="images/calmagick/m3/nostalgia.jpg" alt="images/calmagick/m3/nostalgia.jpg" /></td>
<td><img src="images/calmagick/m3/verdon.jpg" alt="images/calmagick/m3/verdon.jpg" /></td>
</tr></table>
</p>
<p>Note that still bigger rectangles are tried, if they happen to have the same (minimal) entropy. If you really want a fixed size, specify an &quot;empty&quot; size range, i.e., <code>--min-size</code> = <code>--max-size</code>. For example, we declare a fixed size of exactly 20% of the image dimensions as follows:</p>
<p><pre><code>$ calmagick image.jpg 0 0 --min-size=0.2 --max-size=0.2</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/m4/gunn.jpg" alt="images/calmagick/m4/gunn.jpg" /></td>
<td><img src="images/calmagick/m4/nostalgia.jpg" alt="images/calmagick/m4/nostalgia.jpg" /></td>
<td><img src="images/calmagick/m4/verdon.jpg" alt="images/calmagick/m4/verdon.jpg" /></td>
</tr></table>
</p>
<h3 id="duality">Duality</h3>
<p>Instead of minimizing rectangle entropy, we might try maximizing it. This way, the calendar will cover the rectangle with the most &quot;informational content&quot;. Again, the same placement algorithm applies, with relaxation etc.</p>
<p><pre><code>$ calmagick image.jpg 0 0 --placement=max</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/m5/gunn.jpg" alt="images/calmagick/m5/gunn.jpg" /></td>
<td><img src="images/calmagick/m5/nostalgia.jpg" alt="images/calmagick/m5/nostalgia.jpg" /></td>
<td><img src="images/calmagick/m5/verdon.jpg" alt="images/calmagick/m5/verdon.jpg" /></td>
</tr></table>
</p>
<p>I can't think of a reason why you would want to overlay calendars like this. However, entropy maximization can provide a smart way to crop the input images.</p>
<h3 id="smart-crop">Smart-crop</h3>
<p>Because of its usefulness, we can obtain the result of entropy minimization (or maximization, which is equivalent to minimizing the negative value) with the <code>--test</code> argument. Here's how we can smart-crop the input images at exactly 50% of their dimensions:</p>
<p><pre><code>$ calmagick image.jpg --placement=max --min-size=0.5 --max-size=0.5 --test=crop</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/crop/gunn.jpg" alt="images/calmagick/crop/gunn.jpg" /></td>
<td><img src="images/calmagick/crop/nostalgia.jpg" alt="images/calmagick/crop/nostalgia.jpg" /></td>
<td><img src="images/calmagick/crop/verdon.jpg" alt="images/calmagick/crop/verdon.jpg" /></td>
</tr></table>
</p>
<p>Now you can overlay calendars on these cropped images, applying entropy minimization this time ;) Note that I have removed the extra <code>callirhoe</code> arguments, since <code>callirhoe</code> is not run at all.</p>
<h3 id="computer-vision">Computer vision</h3>
<p>We can even see how the algorithm works internally!</p>
<p><pre><code>$ calmagick image.jpg --test=quant</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/v1/gunn.jpg" alt="images/calmagick/v1/gunn.jpg" /></td>
<td><img src="images/calmagick/v1/nostalgia.jpg" alt="images/calmagick/v1/nostalgia.jpg" /></td>
<td><img src="images/calmagick/v1/verdon.jpg" alt="images/calmagick/v1/verdon.jpg" /></td>
</tr></table>
</p>
<p>Thus, entropy minimization is like trying to find a big-dark (almost totally black) rectangle (shown as negative above).</p>
<h2 id="image-prepost-processing">Image pre/post processing</h2>
<p>For convenience you can provide additional ImageMagick operators with the <code>--pre-magic</code>, <code>--in-magick</code> and <code>--post-magick</code> arguments (in this order!). The first set of options is applied at the original input image, the second one at the overlapped area, the third one at the final (composite) image. <code>calmagick</code> already adjusts brightness of the overlapped area (<code>--brightness</code>) by 10%, in order to enhance calendar visibility. Another useful argument is <code>--saturation</code> which adjusts color saturation of the overlayed area. Apart from <code>--brightness</code> and <code>--saturation</code> (<code>calmagick</code> arguments for convenience), <code>--in-magick</code> can give you access to arbitrary ImageMagick operators.</p>
<table><tr>
<p><pre><code>$ calmagick image.jpg 0 0 --brightness=50
$ calmagick image.jpg 0 0 --saturation=0
$ calmagick image.jpg 0 0 --in-magick -blur 0x25
</code></pre>
Each line (top to bottom) corresponds to one of the photos below (left to right):
<table><tr>
<td><img src="images/calmagick/eff1/gunn.jpg" alt="images/calmagick/eff1/gunn.jpg" /></td>
<td><img src="images/calmagick/eff1/nostalgia.jpg" alt="images/calmagick/eff1/nostalgia.jpg" /></td>
<td><img src="images/calmagick/eff1/verdon.jpg" alt="images/calmagick/eff1/verdon.jpg" /></td>
</tr></table>
</p>
<h2 id="working-with-multiple-images">Working with multiple images</h2>
<p>CalMagick also supports filename globbing (shell-like) to automatically process multiple images. In this case, the <code>--range</code> argument becomes handy, as it specifies the month range so that each photo is associated with a different calendar month. It is also possible to shuffle the input images (because globbing works lexicographically). Here's how to process all JPEG images in the current dir, matching the number of images and creating one monthly calendar for each image, starting from January 2015. We even ask for 2 threads (<code>-j</code>), in order to work on different images in parallel! We also specify the name of the folder where output images will be stored (<code>--outdir</code>).</p>
<p><pre><code>$ calmagick '*.jpg' --range=1:0/2015 --outdir=multi -j 2</code></pre></p>
<p>
<table><tr>
<td><img src="images/calmagick/multi/gunn.jpg" alt="images/calmagick/multi/gunn.jpg" /></td>
<td><img src="images/calmagick/multi/nostalgia.jpg" alt="images/calmagick/multi/nostalgia.jpg" /></td>
<td><img src="images/calmagick/multi/verdon.jpg" alt="images/calmagick/multi/verdon.jpg" /></td>
</tr></table>
</p>
<h2 id="conclusion">Conclusion</h2>
<p>This should get you started with the basic functionality. There are more options to play with, simply run <code>calmagick</code> and you will see the full list along with some documentation.</p>

<h3><font color='blue'><i>Have fun with CalMagick!</i></font></h3>


        </section>

        <aside id="sidebar">
          <a href="index.html" class="button">
            <small>back to</small>
            Main Page
          </a>

          <a href="BasicUsersGuide.html" class="button">
            <small>jump to</small>
            Basic Guide
          </a>

          <p class="repo-owner"><a href="https://github.com/geotz/callirhoe"></a> maintained by <a href="https://github.com/geotz">geotz</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33396864-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=8154758;
var sc_invisible=1;
var sc_security="a4d8aee2";
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="create counter"
href="http://statcounter.com/free-hit-counter/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/8154758/0/a4d8aee2/1/"
alt="create counter"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->

  </body>
</html>
